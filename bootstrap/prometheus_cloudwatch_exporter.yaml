apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prometheus-cloudwatch-exporter
  namespace: argocd
spec:
  project: default
  sources:
    - repoURL: https://prometheus-community.github.io/helm-charts
      chart: prometheus-cloudwatch-exporter
      targetRevision: 0.26.0
      helm:
        values: |
          aws:
            role: arn:aws:iam::905418146175:role/prometheus-cloudwatch-exporter-role
            stsRegional:
              enabled: true

          serviceAccount:
            create: true
            name: prometheus-cloudwatch-exporter
            annotations:
              eks.amazonaws.com/role-arn: arn:aws:iam::905418146175:role/prometheus-cloudwatch-exporter-role

          config: |-
            # This is the configuration for prometheus-cloudwatch-exporter
            region: eu-west-2
            period_seconds: 60
            metrics:
            - aws_namespace: "AWS/ApplicationELB"
              aws_dimensions: ["LoadBalancer"]
              aws_metric_name: ["RequestCount", "HealthyHostCount", "UnHealthyHostCount", "TargetResponseTime", "TargetConnectionErrorCount", 
                       "HTTPCode_ELB_4XX_Count", "HTTPCode_ELB_5XX_Count", "HTTPCode_Target_2XX_Count", "HTTPCode_Target_3XX_Count", 
                       "HTTPCode_Target_4XX_Count", "HTTPCode_Target_5XX_Count"]
              aws_statistics: ["Sum", "Average", "Maximum"]
              loadbalancer_name: "k8s-myapp-examplei-eea2b937e5"

            
            
  destination:
    namespace: prometheus-cloudwatch-exporter  # Replace with the namespace you want (e.g., "alloy")
    server: https://kubernetes.default.svc
  syncPolicy:
    syncOptions:
      - CreateNamespace=true
    automated:
      prune: true
      selfHeal: true

